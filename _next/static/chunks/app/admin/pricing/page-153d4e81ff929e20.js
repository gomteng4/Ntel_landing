(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[247],{1549:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var s=r(5155),a=r(2115),l=r(5695),n=r(6874),i=r.n(n),c=r(2099),o=r(5552);function d(){let[e,t]=(0,a.useState)(!1),[r,n]=(0,a.useState)([]),[o,d]=(0,a.useState)(!0),[m,x]=(0,a.useState)(null),[g,h]=(0,a.useState)(!1),p=(0,l.useRouter)();(0,a.useEffect)(()=>{"true"===localStorage.getItem("admin_auth")?(t(!0),b()):p.push("/admin")},[p]);let b=async()=>{try{let{data:e}=await c.N.from("pricing_plans").select("*").order("sort_order");e&&n(e)}catch(e){console.error("Error fetching pricing plans:",e)}finally{d(!1)}},f=async e=>{try{if(e.id&&"new"!==e.id){let{id:t,created_at:r,updated_at:s,...a}=e,{error:l}=await c.N.from("pricing_plans").update(a).eq("id",e.id);if(l)throw l}else{let{id:t,created_at:r,updated_at:s,...a}=e,{error:l}=await c.N.from("pricing_plans").insert(a);if(l)throw l}await b(),h(!1),x(null),alert("요금제가 저장되었습니다!")}catch(e){console.error("Error saving pricing plan:",e),alert("저장 중 오류가 발생했습니다.")}},y=async e=>{if(confirm("정말 삭제하시겠습니까?"))try{let{error:t}=await c.N.from("pricing_plans").delete().eq("id",e);if(t)throw t;await b(),alert("요금제가 삭제되었습니다!")}catch(e){console.error("Error deleting pricing plan:",e),alert("삭제 중 오류가 발생했습니다.")}},j={id:"new",name:"",price:"",original_price:"",tag:"",tag_color:"#ff4757",description:"",features:[],image_url:"",sort_order:r.length+1,is_active:!0,created_at:"",updated_at:""};return!e||o?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"로딩 중..."})})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(i(),{href:"/admin/dashboard",className:"text-blue-600 hover:text-blue-800 mr-4",children:"← 대시보드"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"요금제 관리"})]}),(0,s.jsx)("button",{onClick:()=>{x(j),h(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"새 요금제 추가"})]})})}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[g&&m&&(0,s.jsx)(u,{plan:m,onSave:f,onCancel:()=>{h(!1),x(null)}}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(e=>(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 relative",children:[e.tag&&(0,s.jsx)("div",{className:"absolute -top-3 left-6 px-3 py-1 rounded-full text-white text-sm font-bold",style:{backgroundColor:e.tag_color},children:e.tag}),(0,s.jsxs)("div",{className:"text-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.name}),(0,s.jsx)("div",{className:"text-2xl font-bold text-red-500 mb-1",children:e.price}),e.original_price&&(0,s.jsx)("div",{className:"text-sm text-gray-500 line-through",children:e.original_price})]}),e.features&&Array.isArray(e.features)&&(0,s.jsx)("ul",{className:"text-sm text-gray-600 space-y-1 mb-4",children:e.features.map((e,t)=>(0,s.jsxs)("li",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),e]},t))}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-4 pt-4 border-t border-gray-200",children:[(0,s.jsx)("span",{className:"text-sm ".concat(e.is_active?"text-green-600":"text-red-600"),children:e.is_active?"활성":"비활성"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{x(e),h(!0)},className:"text-blue-600 hover:text-blue-800 px-2 py-1 text-sm",children:"편집"}),(0,s.jsx)("button",{onClick:()=>y(e.id),className:"text-red-600 hover:text-red-800 px-2 py-1 text-sm",children:"삭제"})]})]})]},e.id))})]})]})}function u(e){let{plan:t,onSave:r,onCancel:l}=e,[n,i]=(0,a.useState)(t),[c,d]=(0,a.useState)(Array.isArray(t.features)?t.features.join("\n"):"");return(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg mb-6",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"new"===t.id?"새 요금제 추가":"요금제 편집"})}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=c.split("\n").filter(e=>""!==e.trim());r({...n,features:t})},className:"px-6 py-4 space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"요금제명"}),(0,s.jsx)("input",{type:"text",value:n.name,onChange:e=>i({...n,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"가격"}),(0,s.jsx)("input",{type:"text",value:n.price,onChange:e=>i({...n,price:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"월 21,000원",required:!0})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"원래 가격"}),(0,s.jsx)("input",{type:"text",value:n.original_price||"",onChange:e=>i({...n,original_price:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"월 30,000원"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"태그"}),(0,s.jsx)("input",{type:"text",value:n.tag||"",onChange:e=>i({...n,tag:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"BEST, HOT"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"순서"}),(0,s.jsx)("input",{type:"number",value:n.sort_order,onChange:e=>i({...n,sort_order:parseInt(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"특징 (한 줄에 하나씩)"}),(0,s.jsx)("textarea",{value:c,onChange:e=>d(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"음성통화 7GB 데이터 문자무제한"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"요금제 이미지"}),(0,s.jsx)(o.A,{currentImageUrl:n.image_url,onImageUploaded:e=>i({...n,image_url:e}),folder:"pricing",placeholder:"요금제 이미지를 업로드하세요"})]})]}),(0,s.jsx)("div",{className:"flex items-center space-x-4",children:(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:n.is_active,onChange:e=>i({...n,is_active:e.target.checked}),className:"rounded"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"활성화"})]})}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4 pt-4 border-t border-gray-200",children:[(0,s.jsx)("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"취소"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"저장"})]})]})]})}},2099:(e,t,r)=>{"use strict";r.d(t,{N:()=>i});var s=r(5647),a=r(1890);let l=a.env.NEXT_PUBLIC_SUPABASE_URL||"https://suznpkxteqhvqvlaenrq.supabase.co",n=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1em5wa3h0ZXFodnF2bGFlbnJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzMzQ2NDYsImV4cCI6MjA2NjkxMDY0Nn0.hgGYLUWMoyjB4SpyEfR2nOqaAvPonaefyRZ6T3UYRO8",i=null;try{i=(0,s.UU)(l,n)}catch(e){console.warn("Supabase client initialization failed:",e),i={from:()=>({select:()=>({data:null,error:null}),insert:()=>({data:null,error:null}),update:()=>({data:null,error:null}),delete:()=>({data:null,error:null}),eq:()=>({}),order:()=>({})})}}},5552:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(5155),a=r(2115),l=r(2099);function n(e){let{currentImageUrl:t,onImageUploaded:r,folder:n="general",placeholder:i="이미지를 선택하세요",className:c=""}=e,[o,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(t||null),[x,g]=(0,a.useState)(!1),[h,p]=(0,a.useState)(""),b=(0,a.useRef)(null),f=async e=>{try{d(!0);let t=e.name.split(".").pop(),s="".concat(Date.now(),".").concat(t),a="".concat(n,"/").concat(s),{data:i,error:c}=await l.N.storage.from("images").upload(a,e);if(c)throw console.error("Supabase Storage 오류:",c),Error("Storage 업로드에 실패했습니다. URL을 직접 입력해주세요.");let{data:{publicUrl:o}}=l.N.storage.from("images").getPublicUrl(a);m(o),r(o)}catch(e){console.error("이미지 업로드 오류:",e),alert("이미지 업로드 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:"알 수 없는 오류")),g(!0)}finally{d(!1)}},y=()=>{m(null),r(""),p(""),b.current&&(b.current.value="")};return(0,s.jsxs)("div",{className:"space-y-4 ".concat(c),children:[(0,s.jsx)("input",{ref:b,type:"file",accept:"image/*",onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(!r)return;if(!r.type.startsWith("image/"))return void alert("이미지 파일만 업로드 가능합니다.");if(r.size>5242880)return void alert("파일 크기는 5MB 이하여야 합니다.");let s=new FileReader;s.onload=()=>{m(s.result)},s.readAsDataURL(r),f(r)},className:"hidden"}),u?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:u,alt:"미리보기",className:"w-full h-48 object-cover rounded-lg border border-gray-300"}),(0,s.jsx)("button",{type:"button",onClick:y,className:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 transition-colors",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,s.jsx)("div",{className:"w-full h-48 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,s.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:i})]})}),x&&(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이미지 URL 직접 입력"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"url",value:h,onChange:e=>p(e.target.value),placeholder:"https://example.com/image.jpg",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,s.jsx)("button",{type:"button",onClick:()=>{if(!h.trim())return void alert("URL을 입력해주세요.");try{new URL(h),m(h),r(h),g(!1),p("")}catch(e){alert("올바른 URL을 입력해주세요.")}},className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm font-medium",children:"적용"})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{var e;null==(e=b.current)||e.click()},disabled:o,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors",children:o?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"업로드 중..."]}):"파일 선택"}),(0,s.jsx)("button",{type:"button",onClick:()=>g(!x),className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md text-sm font-medium transition-colors",children:"URL 입력"}),u&&(0,s.jsx)("button",{type:"button",onClick:y,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md text-sm font-medium transition-colors",children:"제거"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"파일 업로드 또는 이미지 URL을 직접 입력할 수 있습니다. (JPG, PNG, GIF, 최대 5MB)"})]})}},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},7286:(e,t,r)=>{Promise.resolve().then(r.bind(r,1549))}},e=>{var t=t=>e(e.s=t);e.O(0,[874,647,441,303,358],()=>t(7286)),_N_E=e.O()}]);